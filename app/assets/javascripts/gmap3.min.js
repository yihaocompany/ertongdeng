/*
 *  GMAP3 Plugin for JQuery 
 *  Version   : 4.1
 *  Date      : 2011-11-18
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html  
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Web site  : http://gmap3.net
 *   
 *  Copyright (c) 2010-2011 Jean-Baptiste DEMONTE
 *  All rights reserved.
 *   
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions are met:
 * 
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   - Redistributions in binary form must reproduce the above 
 *     copyright notice, this list of conditions and the following 
 *     disclaimer in the documentation and/or other materials provided 
 *     with the distribution.
 *   - Neither the name of the author nor the names of its contributors 
 *     may be used to endorse or promote products derived from this 
 *     software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 */
!function(r){function m(){var r=[];this.empty=function(){for(var m=0;m<r.length;m++)if(r[m])return!1;return!0},this.add=function(m){r.push(m)},this.addNext=function(m){var x,e=[],t=0;for(x=0;x<r.length;x++)r[x]&&(1==t&&e.push(m),e.push(r[x]),t++);2>t&&e.push(m),r=e},this.get=function(){for(var m=0;m<r.length;m++)if(r[m])return r[m];return!1},this.ack=function(){for(var m=0;m<r.length;m++)if(r[m]){delete r[m];break}this.empty()&&(r=[])}}function x(){var m={};this.add=function(r,x,e){return r=r.toLowerCase(),m[r]||(m[r]=[]),m[r].push({obj:x,tag:o(e,"tag")}),r+"-"+(m[r].length-1)},this.get=function(x,e,t){var n,d,i;if(x=x.toLowerCase(),!m[x]||!m[x].length)return null;for(d=e?m[x].length:-1,i=e?-1:1,n=0;n<m[x].length;n++)if(d+=i,m[x][d]){if(void 0!==t&&(void 0===m[x][d].tag||r.inArray(m[x][d].tag,t)<0))continue;return m[x][d].obj}return null},this.all=function(x,e){var t,n=[];if(x=x.toLowerCase(),!m[x]||!m[x].length)return n;for(t=0;t<m[x].length;t++)m[x][t]&&(void 0!==e&&(void 0===m[x][t].tag||r.inArray(m[x][t].tag,e)<0)||n.push(m[x][t].obj));return n},this.names=function(){var r,x=[];for(r in m)x.push(r);return x},this.refToObj=function(r){return r=r.split("-"),2==r.length&&m[r[0]]&&m[r[0]][r[1]]?m[r[0]][r[1]].obj:null},this.rm=function(x,e,t){var n,d,i;if(x=x.toLowerCase(),!m[x])return!1;if(void 0!==e)if(t)for(n=m[x].length-1;n>=0&&!(void 0!==m[x][n]&&void 0!==m[x][n].tag&&r.inArray(m[x][n].tag,e)>=0);n--);else for(n=0;n<m[x].length&&!(void 0!==m[x][n]&&void 0!==m[x][n].tag&&r.inArray(m[x][n].tag,e)>=0);n++);else n=t?m[x].length-1:0;if(!(n in m[x]))return!1;if("function"==typeof m[x][n].obj.setMap&&m[x][n].obj.setMap(null),"function"==typeof m[x][n].obj.remove&&m[x][n].obj.remove(),"function"==typeof m[x][n].obj.free&&m[x][n].obj.free(),delete m[x][n].obj,void 0!==e){for(i=[],d=0;d<m[x].length;d++)d!==n&&i.push(m[x][d]);m[x]=i}else t?m[x].pop():m[x].shift();return!0},this.clear=function(r,x,e,t){var n,d,i;if(r&&r.length)r=g(r);else{r=[];for(n in m)r.push(n)}for(d=0;d<r.length;d++)if(r[d]){if(i=r[d].toLowerCase(),!m[i])continue;if(x)this.rm(i,t,!0);else if(e)this.rm(i,t,!1);else for(;this.rm(i,t,!1););}}}function e(){var m,x=[],e=[],t=[],n=[],d=!1;this.events=function(){for(var r=0;r<arguments.length;r++)e.push(arguments[r])},this.startRedraw=function(){return d?!1:(d=!0,!0)},this.endRedraw=function(){d=!1},this.redraw=function(){var r,x=[],e=this;for(r=0;r<arguments.length;r++)x.push(arguments[r]);this.startRedraw?(m.apply(e,x),this.endRedraw()):setTimeout(function(){e.redraw.apply(e,x)},50)},this.setRedraw=function(r){m=r},this.store=function(r,m,x){t.push({data:r,obj:m,shadow:x})},this.free=function(){for(var r=0;r<e.length;r++)google.maps.event.removeListener(e[r]);e=[],this.freeAll()},this.freeIndex=function(r){"function"==typeof t[r].obj.setMap&&t[r].obj.setMap(null),"function"==typeof t[r].obj.remove&&t[r].obj.remove(),t[r].shadow&&("function"==typeof t[r].shadow.remove&&t[r].obj.remove(),"function"==typeof t[r].shadow.setMap&&t[r].shadow.setMap(null),delete t[r].shadow),delete t[r].obj,delete t[r].data,delete t[r]},this.freeAll=function(){var r;for(r=0;r<t.length;r++)t[r]&&this.freeIndex(r);t=[]},this.freeDiff=function(m){var x,e,n={},d=[];for(x=0;x<m.length;x++)d.push(m[x].idx.join("-"));for(x=0;x<t.length;x++)t[x]&&(e=r.inArray(t[x].data.idx.join("-"),d),e>=0?n[e]=!0:this.freeIndex(x));return n},this.add=function(r,m){x.push({latLng:r,marker:m})},this.get=function(r){return x[r]},this.clusters=function(r,m,e,t){var d,i,o,a,s,l,u,c,v,f,p,h,g,y,b=r.getProjection(),w=b.fromLatLngToPoint(new google.maps.LatLng(r.getBounds().getNorthEast().lat(),r.getBounds().getSouthWest().lng())),T=r.getZoom(),C={},k={},S={},E=[],L=r.getBounds(),N=e&&e<=r.getZoom(),_=r.getZoom()>2;for(y=0,g={},d=0;d<x.length;d++)(!_||L.contains(x[d].latLng))&&(a=b.fromLatLngToPoint(x[d].latLng),C[d]=[Math.floor((a.x-w.x)*Math.pow(2,T)),Math.floor((a.y-w.y)*Math.pow(2,T))],g[d]=!0,y++);if(!t&&!N){for(u=0;u<n.length&&u in g;u++)y--;if(!y)return!1}n=g,g=[];for(d in C)s=C[d][0],l=C[d][1],s in k||(k[s]={}),l in k[s]||(k[s][l]=d,S[d]={},g.push(d)),S[k[s][l]][d]=!0;for(m=Math.pow(m,2),delete k,u=0;;){for(;u<g.length&&!(g[u]in S);)u++;if(u==g.length)break;if(d=g[u],p=C[d][0],h=C[d][1],k=null,N)k={lat:p,lng:h,idx:[d]};else do{for(v={lat:0,lng:0,idx:[]},c=u;c<g.length;c++)if(g[c]in S&&(i=g[c],Math.pow(p-C[i][0],2)+Math.pow(h-C[i][1],2)<=m))for(o in S[i])v.lat+=x[o].latLng.lat(),v.lng+=x[o].latLng.lng(),v.idx.push(o);v.lat/=v.idx.length,v.lng/=v.idx.length,k?(f=v.idx.length>k.idx.length,f&&(k=v)):(f=v.idx.length>1,k=v),f&&(a=b.fromLatLngToPoint(new google.maps.LatLng(k.lat,k.lng)),p=Math.floor((a.x-w.x)*Math.pow(2,T)),h=Math.floor((a.y-w.y)*Math.pow(2,T)))}while(f);for(c=0;c<k.idx.length;c++)k.idx[c]in S&&delete S[k.idx[c]];E.push(k)}return E},this.getBounds=function(){var r,m=new google.maps.LatLngBounds;for(r=0;r<x.length;r++)m.extend(x[r].latLng);return m}}function t(m){for(var x in m)C[x]="object"==typeof C[x]?r.extend({},C[x],m[x]):m[x]}function n(r){if(!r)return!0;for(var m=0;m<E.length;m++)if(E[m]===r)return!1;return!0}function d(r){for(var m=o(r,"action"),x=0;x<L.length;x++)if(L[x]===m)return!0;return!1}function i(r,m){if(m.toLowerCase){m=m.toLowerCase();for(var x in r)if(x.toLowerCase&&x.toLowerCase()==m)return x}return!1}function o(r,m,x){var e=i(r,m);return e?r[e]:x}function a(r,m){var x,e;if(!r||!m)return!1;m=g(m);for(x in r)if(x.toLowerCase){x=x.toLowerCase();for(e in m)if(x==m[e])return!0}return!1}function s(r,m,x){if(a(r,S)||a(r,m)){var e,t;for(e=0;e<S.length;e++)t=i(r,S[e]),x[S[e]]=t?r[t]:{};if(m&&m.length)for(e=0;e<m.length;e++)(t=i(r,m[e]))&&(x[m[e]]=r[t]);return x}x.options={};for(t in r)"action"!==t&&(x.options[t]=r[t]);return x}function l(r,m,x,e){var t,n=i(m,r),d={},l=["map"];if(d.callback=o(m,"callback"),x=g(x),e=g(e),n)return s(m[n],x,d);if(e&&e.length)for(t=0;t<e.length;t++)l.push(e[t]);for(a(m,l)||(d=s(m,x,d)),t=0;t<S.length;t++)S[t]in d||(d[S[t]]={});return d}function u(){return N||(N=new google.maps.Geocoder),N}function c(){return directionsService||(directionsService=new google.maps.DirectionsService),directionsService}function v(){return elevationService||(elevationService=new google.maps.ElevationService),elevationService}function f(){return maxZoomService||(maxZoomService=new google.maps.MaxZoomService),maxZoomService}function p(){return distanceMatrixService||(distanceMatrixService=new google.maps.DistanceMatrixService),distanceMatrixService}function h(r){return("number"==typeof r||"string"==typeof r)&&""!==r&&!isNaN(r)}function g(r){var m,x=[];if(void 0!==r)if("object"==typeof r)if("number"==typeof r.length)x=r;else for(m in r)x.push(r[m]);else x.push(r);return x}function b(r,m,x){var e=m?r:null;return r&&"string"!=typeof r?r.latLng?b(r.latLng):"function"==typeof r.lat?r:h(r.lat)?new google.maps.LatLng(r.lat,r.lng):!x&&r.length?h(r[0])&&h(r[1])?new google.maps.LatLng(r[0],r[1]):e:e:e}function w(r,m,x){var e,t,n;return r?(n=x?r:null,"function"==typeof r.getCenter?r:(r.length?2==r.length?(e=b(r[0]),t=b(r[1])):4==r.length&&(e=b([r[0],r[1]]),t=b([r[2],r[3]])):"ne"in r&&"sw"in r?(e=b(r.ne),t=b(r.sw)):"n"in r&&"e"in r&&"s"in r&&"w"in r&&(e=b([r.n,r.e]),t=b([r.s,r.w])),e&&t?new google.maps.LatLngBounds(t,e):n)):null}function T(d){var i=new m,s=new x,h=null,T={},S=!1;this._plan=function(r){for(var m=0;m<r.length;m++)i.add(r[m]);this._run()},this._planNext=function(r){i.addNext(r)},this._direct=function(m){var x=o(m,"action");return this[x](r.extend({},x in C?C[x]:{},m.args?m.args:m))},this._end=function(){S=!1,i.ack(),this._run()},this._run=function(){if(!S){var r=i.get();r&&(S=!0,this._proceed(r))}},this._proceed=function(m){m=m||{};var x,e=o(m,"action")||"init",t=e.toLowerCase(),d=!0,i=o(m,"target"),a=o(m,"args");!h&&n(t)&&this.init(r.extend({},C.init,m.args&&m.args.map?m.args.map:m.map?m.map:{}),!0),!i&&!a&&t in this&&"function"==typeof this[t]?this[t](r.extend({},t in C?C[t]:{},m.args?m.args:m)):(i&&"object"==typeof i?(d="function"==typeof i[e])&&(x=i[e].apply(i,m.args?m.args:[])):h&&(d="function"==typeof h[e])&&(x=h[e].apply(h,m.args?m.args:[])),!d&&C.verbose&&alert("unknown action : "+e),this._callback(x,m),this._end())},this._resolveLatLng=function(r,m,x,e){var t,n=o(r,"address"),d=this,i="function"==typeof m?m:d[m];n?(e||(e=0),t="object"==typeof n?n:{address:n},u().geocode(t,function(t,n){n===google.maps.GeocoderStatus.OK?i.apply(d,[r,x?t:t[0].geometry.location]):n===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&e<C.queryLimit.attempt?setTimeout(function(){d._resolveLatLng(r,m,x,e+1)},C.queryLimit.delay+Math.floor(Math.random()*C.queryLimit.random)):(C.verbose&&alert("Geocode error : "+n),i.apply(d,[r,!1]))})):i.apply(d,[r,b(r,!1,!0)])},this._resolveAllLatLng=function(r,m,x){var e=this,t=-1,n=function(){do t++;while(t<r[m].length&&!("address"in r[m][t]));t<r[m].length?!function(r){e._resolveLatLng(r,function(r,m){r.latLng=m,n.apply(e,[])})}(r[m][t]):e[x](r)};n()},this._call=function(){var r,m=arguments[0],x=[];if(arguments.length&&h&&"function"==typeof h[m]){for(r=1;r<arguments.length;r++)x.push(arguments[r]);return h[m].apply(h,x)}},this._subcall=function(m,x){var e={};m.map&&(x||(x=o(m.map,"latlng")),h?(m.map.center&&x&&this._call("setCenter",x),void 0!==m.map.zoom&&this._call("setZoom",m.map.zoom),void 0!==m.map.mapTypeId&&this._call("setMapTypeId",m.map.mapTypeId)):(x&&(e={center:x}),this.init(r.extend({},m.map,e),!0)))},this._attachEvent=function(r,m,x,e,t){google.maps.event["addListener"+(t?"Once":"")](r,m,function(m){x.apply(d,[r,m,e])})},this._attachEvents=function(r,m){var x;if(m){if(m.events)for(x in m.events)"function"==typeof m.events[x]&&this._attachEvent(r,x,m.events[x],m.data,!1);if(m.onces)for(x in m.onces)"function"==typeof m.onces[x]&&this._attachEvent(r,x,m.onces[x],m.data,!0)}},this._callback=function(r,m){if("function"==typeof m.callback)m.callback.apply(d,[r]);else if("object"==typeof m.callback)for(var x=0;x<m.callback.length;x++)"function"==typeof m.callback[x]&&m.callback[k].apply(d,[r])},this._manageEnd=function(r,m,x){var e,t;if(r&&"object"==typeof r&&(this._attachEvents(r,m),m.apply&&m.apply.length))for(e=0;e<m.apply.length;e++)t=m.apply[e],t.action&&"function"==typeof r[t.action]&&(t.args?r[t.action].apply(r,t.args):r[t.action]());x||(this._callback(r,m),this._end())},this.destroy=function(r){var m;s.clear(),d.empty();for(m in T)delete T[m];T={},h&&delete h,this._callback(null,r),this._end()},this.init=function(m,x){var e,t,n;if(h)return this._end();if(e=l("map",m),"boolean"==typeof e.options.center&&e.options.center)return!1;n=r.extend({},C.init,e.options),n.center||(n.center=[C.init.center.lat,C.init.center.lng]),n.center=b(n.center),h=new C.classes.Map(d.get(0),n);for(t in T)h.mapTypes.set(t,T[t]);return this._manageEnd(h,e,x),!0},this.getlatlng=function(r){this._resolveLatLng(r,"_getLatLng",!0)},this._getLatLng=function(r,m){this._manageEnd(m,r)},this.getaddress=function(r,m){var x=b(r,!1,!0),e=o(r,"address"),t=x?{latLng:x}:e?"string"==typeof e?{address:e}:e:null,n=o(r,"callback"),i=this;m||(m=0),t&&"function"==typeof n?u().geocode(t,function(x,e){if(e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&m<C.queryLimit.attempt)setTimeout(function(){i.getaddress(r,m+1)},C.queryLimit.delay+Math.floor(Math.random()*C.queryLimit.random));else{var t=e===google.maps.GeocoderStatus.OK?x:!1;n.apply(d,[t,e]),!t&&C.verbose&&alert("Geocode error : "+e),i._end()}}):this._end()},this.getroute=function(r){var m=o(r,"callback"),x=this;"function"==typeof m&&r.options?(r.options.origin=b(r.options.origin,!0),r.options.destination=b(r.options.destination,!0),c().route(r.options,function(r,e){var t=e==google.maps.DirectionsStatus.OK?r:!1;m.apply(d,[t,e]),x._end()})):this._end()},this.getelevation=function(r){var m,x,e,t,n=[],i=o(r,"callback"),a=o(r,"latlng"),s=this;if("function"==typeof i){if(m=function(r,m){var x=m===google.maps.ElevationStatus.OK?r:!1;i.apply(d,[x,m]),s._end()},a)n.push(b(a));else if(n=o(r,"locations")||[])for(n=g(n),t=0;t<n.length;t++)n[t]=b(n[t]);if(n.length)v().getElevationForLocations({locations:n},m);else if(x=o(r,"path"),e=o(r,"samples"),x&&e){for(t=0;t<x.length;t++)n.push(b(x[t]));n.length&&v().getElevationAlongPath({path:n,samples:e},m)}}else this._end()},this.getdistance=function(r){var m,x=o(r,"callback"),e=this;if("function"==typeof x&&r.options&&r.options.origins&&r.options.destinations){for(r.options.origins=g(r.options.origins),m=0;m<r.options.origins.length;m++)r.options.origins[m]=b(r.options.origins[m],!0);for(r.options.destinations=g(r.options.destinations),m=0;m<r.options.destinations.length;m++)r.options.destinations[m]=b(r.options.destinations[m],!0);p().getDistanceMatrix(r.options,function(r,m){var t=m==google.maps.DistanceMatrixStatus.OK?r:!1;x.apply(d,[t,m]),e._end()})}else this._end()},this.addmarker=function(r){this._resolveLatLng(r,"_addMarker")},this._addMarker=function(r,m,x){var e,t,n,d=l("marker",r,"to");if(x){if(!m)return}else{if(!m)return this._manageEnd(!1,d),void 0;this._subcall(r,m)}return d.to?(n=s.refToObj(d.to),e=n&&"function"==typeof n.add,e&&(n.add(m,r),"function"==typeof n.redraw&&n.redraw()),x||this._manageEnd(e,d)):(d.options.position=m,d.options.map=h,e=new C.classes.Marker(d.options),a(r,"infowindow")&&(t=l("infowindow",r.infowindow,"open"),(void 0===t.open||t.open)&&(t.apply=g(t.apply),t.apply.unshift({action:"open",args:[h,e]})),t.action="addinfowindow",this._planNext(t)),x||(s.add("marker",e,d),this._manageEnd(e,d))),e},this.addmarkers=function(r){o(r,"clusters")?this._resolveAllLatLng(r,"markers","_addclusteredmarkers"):this._resolveAllLatLng(r,"markers","_addmarkers")},this._addmarkers=function(m){var x,e,t,n,d,i,a,u={},c=o(m,"markers");if(this._subcall(m),"object"!=typeof c)return this._end();if(e=l("marker",m,["to","markers"]),e.to){if(a=s.refToObj(e.to),x=a&&"function"==typeof a.add){for(t=0;t<c.length;t++)(n=b(c[t]))&&a.add(n,c[t]);"function"==typeof a.redraw&&a.redraw()}this._manageEnd(x,e)}else{for(r.extend(!0,u,e.options),u.map=h,x=[],t=0;t<c.length;t++)(n=b(c[t]))&&(c[t].options?(i={},r.extend(!0,i,u,c[t].options),e.options=i):e.options=u,e.options.position=n,d=new C.classes.Marker(e.options),x.push(d),e.data=c[t].data,e.tag=c[t].tag,s.add("marker",d,e),this._manageEnd(d,e,!0));e.options=u,this._callback(x,m),this._end()}},this._addclusteredmarkers=function(r){var m,x,t,n,d=this,i=o(r,"radius"),a=o(r,"maxZoom"),s=o(r,"markers"),l=o(r,"clusters");if(!h.getBounds())return google.maps.event.addListenerOnce(h,"bounds_changed",function(){d._addclusteredmarkers(r)}),void 0;if("number"==typeof i){for(m=new e,x=0;x<s.length;x++)t=b(s[x]),m.add(t,s[x]);n=this._initClusters(r,m,i,a,l)}this._callback(n,r),this._end()},this._initClusters=function(r,m,x,e,t){var n=this;return m.setRedraw(function(d){var i,o=m.clusters(h,x,e,d);o&&(i=m.freeDiff(o),n._displayClusters(r,m,o,i,t))}),m.events(google.maps.event.addListener(h,"zoom_changed",function(){m.redraw(!0)}),google.maps.event.addListener(h,"bounds_changed",function(){m.redraw()})),m.redraw(),s.add("cluster",m,r)},this._displayClusters=function(m,x,e,t,n){var d,i,s,u,c,v,f,p,h,g,y,w,T,C=a(m,"cluster")?l("",o(m,"cluster")):{},k=a(m,"marker")?l("",o(m,"marker")):{};for(i=0;i<e.length;i++)if(!(i in t)){if(p=e[i],c=!1,p.idx.length>1){u=0;for(d in n)d>u&&d<=p.idx.length&&(u=d);if(n[u]){for(y=o(n[u],"width"),w=o(n[u],"height"),T={},r.extend(!0,T,C,{options:{pane:"overlayLayer",content:n[u].content.replace("CLUSTER_COUNT",p.idx.length),offset:{x:-y/2,y:-w/2}}}),v=this._addOverlay(T,b(p),!0),T.options.pane="floatShadow",T.options.content=r("<div></div>"),T.options.content.width(y),T.options.content.height(w),f=this._addOverlay(T,b(p),!0),C.data={latLng:b(p),markers:[]},s=0;s<p.idx.length;s++)C.data.markers.push(x.get(p.idx[s]).marker);this._attachEvents(f,C),x.store(p,v,f),c=!0}}if(!c){for(h={},r.extend(!0,h,k.options),s=0;s<p.idx.length;s++)u=x.get(p.idx[s]),k.latLng=u.latLng,k.data=u.marker.data,k.tag=u.marker.tag,u.marker.options?(g={},r.extend(!0,g,h,u.marker.options),k.options=g):k.options=h,v=this._addMarker(k,k.latLng,!0),this._attachEvents(v,k),x.store(p,v);k.options=h}}},this.addinfowindow=function(r){this._resolveLatLng(r,"_addInfoWindow")},this._addInfoWindow=function(r,m){var x,e,t=[];this._subcall(r,m),x=l("infowindow",r,["open","anchor"]),m&&(x.options.position=m),e=new C.classes.InfoWindow(x.options),(void 0===x.open||x.open)&&(x.apply=g(x.apply),t.push(h),x.anchor&&t.push(x.anchor),x.apply.unshift({action:"open",args:t})),s.add("infowindow",e,x),this._manageEnd(e,x)},this.addpolyline=function(r){this._addPoly(r,"Polyline","path")},this.addpolygon=function(r){this._addPoly(r,"Polygon","paths")},this._addPoly=function(r,m,x){var e,t,n,d=l(m.toLowerCase(),r,x);if(d[x])for(d.options[x]=[],e=0;e<d[x].length;e++)(n=b(d[x][e]))&&d.options[x].push(n);t=new google.maps[m](d.options),t.setMap(h),s.add(m.toLowerCase(),t,d),this._manageEnd(t,d)},this.addcircle=function(r){this._resolveLatLng(r,"_addCircle")},this._addCircle=function(r,m){var x,e=l("circle",r);return m||(m=b(e.options.center)),m?(this._subcall(r,m),e.options.center=m,e.options.map=h,x=new C.classes.Circle(e.options),s.add("circle",x,e),this._manageEnd(x,e),void 0):this._manageEnd(!1,e)},this.addrectangle=function(r){this._resolveLatLng(r,"_addRectangle")},this._addRectangle=function(r){var m,x=l("rectangle",r);return x.options.bounds=w(x.options.bounds,!0),x.options.bounds?(this._subcall(r,x.options.bounds.getCenter()),x.options.map=h,m=new C.classes.Rectangle(x.options),s.add("rectangle",m,x),this._manageEnd(m,x),void 0):this._manageEnd(!1,x)},this.addoverlay=function(r){this._resolveLatLng(r,"_addOverlay")},this._addOverlay=function(m,x,e){function t(){C.classes.OverlayView.call(this),this.setMap(h)}var n,d=l("overlay",m),i=r.extend({pane:"floatPane",content:"",offset:{x:0,y:0}},d.options),o=r("<div></div>"),a=[];return o.css("border","none").css("borderWidth","0px").css("position","absolute"),o.append(i.content),t.prototype=new C.classes.OverlayView,t.prototype.onAdd=function(){var m=this.getPanes();i.pane in m&&r(m[i.pane]).append(o)},t.prototype.draw=function(){var m=this.getProjection(),e=m.fromLatLngToDivPixel(x),t=this;o.css("left",e.x+i.offset.x+"px").css("top",e.y+i.offset.y+"px"),r.each("dblclick click mouseover mousemove mouseout mouseup mousedown".split(" "),function(r,m){a.push(google.maps.event.addDomListener(o[0],m,function(){google.maps.event.trigger(t,m)}))}),a.push(google.maps.event.addDomListener(o[0],"contextmenu",function(){google.maps.event.trigger(t,"rightclick")}))},t.prototype.onRemove=function(){for(var r=0;r<a.length;r++)google.maps.event.removeListener(a[r]);o.remove()},t.prototype.hide=function(){o.hide()},t.prototype.show=function(){o.show()},t.prototype.toggle=function(){o&&(o.is(":visible")?this.show():this.hide())},t.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(h)},t.prototype.getDOMElement=function(){return o[0]},n=new t,e||(s.add("overlay",n,d),this._manageEnd(n,d)),n},this.addfixpanel=function(m){var x,e,t=l("fixpanel",m),n=y=0;t.options.content&&(x=r(t.options.content),void 0!==t.options.left?n=t.options.left:void 0!==t.options.right?n=d.width()-x.width()-t.options.right:t.options.center&&(n=(d.width()-x.width())/2),void 0!==t.options.top?y=t.options.top:void 0!==t.options.bottom?y=d.height()-x.height()-t.options.bottom:t.options.middle&&(y=(d.height()-x.height())/2),e=r("<div></div>").css("position","absolute").css("top",y+"px").css("left",n+"px").css("z-index","1000").append(x),d.first().prepend(e),this._attachEvents(h,t),s.add("fixpanel",e,t),this._callback(e,t)),this._end()},this.adddirectionsrenderer=function(r,m){var x,e=l("directionrenderer",r,"panelId");return e.options.map=h,x=new google.maps.DirectionsRenderer(e.options),e.panelId&&x.setPanel(document.getElementById(e.panelId)),s.add("directionrenderer",x,e),this._manageEnd(x,e,m),x},this.setdirectionspanel=function(r){var m=s.get("directionrenderer"),x=l("directionpanel",r,"id");m&&x.id&&m.setPanel(document.getElementById(x.id)),this._manageEnd(m,x)},this.setdirections=function(r){var m=s.get("directionrenderer"),x=l("directions",r);r&&(x.options.directions=r.directions?r.directions:r.options&&r.options.directions?r.options.directions:null),x.options.directions&&(m?m.setDirections(x.options.directions):m=this.adddirectionsrenderer(x,!0)),this._manageEnd(m,x)},this.setstreetview=function(r){var m,x=l("streetview",r,"id");x.options.position&&(x.options.position=b(x.options.position)),m=new C.classes.StreetViewPanorama(document.getElementById(x.id),x.options),m&&h.setStreetView(m),this._manageEnd(m,x)},this.addkmllayer=function(r){var m,x=l("kmllayer",r,"url");x.options.map=h,"string"==typeof x.url&&(m=new C.classes.KmlLayer(x.url,x.options)),s.add("kmllayer",m,x),this._manageEnd(m,x)},this.addtrafficlayer=function(r){var m=l("trafficlayer",r),x=s.get("trafficlayer");x||(x=new C.classes.TrafficLayer,x.setMap(h),s.add("trafficlayer",x,m)),this._manageEnd(x,m)},this.addbicyclinglayer=function(r){var m=l("bicyclinglayer",r),x=s.get("bicyclinglayer");x||(x=new C.classes.BicyclingLayer,x.setMap(h),s.add("bicyclinglayer",x,m)),this._manageEnd(x,m)},this.addgroundoverlay=function(r){var m,x=l("groundoverlay",r,["bounds","url"]);x.bounds=w(x.bounds),x.bounds&&"string"==typeof x.url&&(m=new C.classes.GroundOverlay(x.url,x.bounds),m.setMap(h),s.add("groundoverlay",m,x)),this._manageEnd(m,x)},this.geolatlng=function(r){var m=o(r,"callback");"function"==typeof m&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(r){var x=new google.maps.LatLng(r.coords.latitude,r.coords.longitude);m.apply(d,[x])},function(){var r=!1;m.apply(d,[r])}):google.gears?google.gears.factory.create("beta.geolocation").getCurrentPosition(function(r){var x=new google.maps.LatLng(r.latitude,r.longitude);m.apply(d,[x])},function(){out=!1,m.apply(d,[out])}):m.apply(d,[!1])),this._end()},this.addstyledmap=function(r,m){var x=l("styledmap",r,["id","style"]);x.style&&x.id&&!T[x.id]&&(T[x.id]=new C.classes.StyledMapType(x.style,x.options),h&&h.mapTypes.set(x.id,T[x.id])),this._manageEnd(T[x.id],x,m)},this.setstyledmap=function(r){var m=l("styledmap",r,["id","style"]);m.id&&(this.addstyledmap(m,!0),T[m.id]&&(h.setMapTypeId(m.id),this._callback(T[m.id],r))),this._manageEnd(T[m.id],m)},this.clear=function(r){var m=g(o(r,"list")||o(r,"name")),x=o(r,"last",!1),e=o(r,"first",!1),t=o(r,"tag");void 0!==t&&(t=g(t)),s.clear(m,x,e,t),this._end()},this.get=function(r){var m=o(r,"name")||"map",x=o(r,"first"),e=o(r,"all"),t=o(r,"tag");return m=m.toLowerCase(),"map"===m?h:(void 0!==t&&(t=g(t)),x?s.get(m,!1,t):e?s.all(m,t):s.get(m,!0,t))},this.getmaxzoom=function(r){this._resolveLatLng(r,"_getMaxZoom")},this._getMaxZoom=function(r,m){var x=o(r,"callback"),e=this;x&&"function"==typeof x?f().getMaxZoomAtLatLng(m,function(r){var m=r.status===google.maps.MaxZoomStatus.OK?r.zoom:!1;x.apply(d,[m,r.status]),e._end()}):this._end()},this.setdefault=function(r){t(r),this._end()},this.autofit=function(r,m){var x,e,t,n,d,i=!0,a=new google.maps.LatLngBounds,l=o(r,"maxZoom",null);for(x=s.names(),n=0;n<x.length;n++)for(e=s.all(x[n]),d=0;d<e.length;d++)t=e[d],t.getPosition?(a.extend(t.getPosition()),i=!1):t.getBounds?(a.extend(t.getBounds().getNorthEast()),a.extend(t.getBounds().getSouthWest()),i=!1):t.getPaths?t.getPaths().forEach(function(r){r.forEach(function(r){a.extend(r),i=!1})}):t.getPath?t.getPath().forEach(function(r){a.extend(r),i=!1}):t.getCenter&&(a.extend(t.getCenter()),i=!1);i||h.getBounds()&&h.getBounds().equals(a)||(null!==l&&google.maps.event.addListenerOnce(h,"bounds_changed",function(){this.getZoom()>l&&this.setZoom(l)}),h.fitBounds(a)),m||this._manageEnd(i?!1:a,r,m)}}var C={verbose:!1,queryLimit:{attempt:5,delay:250,random:250},init:{mapTypeId:google.maps.MapTypeId.ROADMAP,center:[46.578498,2.457275],zoom:2},classes:{Map:google.maps.Map,Marker:google.maps.Marker,InfoWindow:google.maps.InfoWindow,Circle:google.maps.Circle,Rectangle:google.maps.Rectangle,OverlayView:google.maps.OverlayView,StreetViewPanorama:google.maps.StreetViewPanorama,KmlLayer:google.maps.KmlLayer,TrafficLayer:google.maps.TrafficLayer,BicyclingLayer:google.maps.BicyclingLayer,GroundOverlay:google.maps.GroundOverlay,StyledMapType:google.maps.StyledMapType}},S=["events","onces","options","apply","callback","data","tag"],E=["init","geolatlng","getlatlng","getroute","getelevation","getdistance","addstyledmap","setdefault","destroy"],L=["get"],N=directionsService=elevationService=maxZoomService=distanceMatrixService=null;r.fn.gmap3=function(){var m,x,e=[],n=!0,i=[];for(m=0;m<arguments.length;m++)x=arguments[m]||{},"string"==typeof x&&(x={action:x}),e.push(x);return e.length||e.push({}),r.each(this,function(){var m=r(this),x=m.data("gmap3");n=!1,x||(x=new T(m),m.data("gmap3",x)),1==e.length&&d(e[0])?i.push(x._direct(e[0])):x._plan(e)}),i.length?1===i.length?i[0]:i:(n&&2==arguments.length&&"string"==typeof arguments[0]&&"setdefault"===arguments[0].toLowerCase()&&t(arguments[1]),this)}}(jQuery);